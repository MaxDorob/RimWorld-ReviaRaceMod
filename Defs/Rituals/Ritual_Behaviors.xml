<?xml version="1.0" encoding="utf-8" ?>
<Defs>

  <RitualBehaviorDef Abstract="True" Name="Revia_DateRitualBehavior">
    <durationTicks>6250</durationTicks>
    <spectatorsLabel>Participants</spectatorsLabel>
    <spectatorGerund>participate</spectatorGerund>
    <stages>
      <li>
        <defaultDuty>Spectate</defaultDuty>
        <essential>True</essential>
        <endTriggers>
          <li Class="StageEndTrigger_DurationPercentage">
            <percentage>0.3</percentage>
          </li>
        </endTriggers>
        <postAction Class="RitualStageAction_Message">
            <text>{0}: The speech is over, and the party is beginning.</text>
            <messageTypeDef>NeutralEvent</messageTypeDef>
        </postAction>
        <roleBehaviors>
          <li>
            <roleId>leader</roleId>
            <dutyDef>Revia_SpeakOnCellFacingSpectators</dutyDef>
            <speakerInteraction>Speech_DateRitual</speakerInteraction>
            <customPositions>
              <!--<li Class="RitualPosition_Lectern">
                <maxDistanceToFocus>5</maxDistanceToFocus>
              </li>-->
              <li Class="RitualPosition_BesideThing" />
            </customPositions>
          </li>
        </roleBehaviors>
      </li>
      <li>
        <defaultDuty>Party</defaultDuty>
        <endTriggers>
          <li Class="StageEndTrigger_DurationPercentage">
            <percentage>0.7</percentage>
          </li>
        </endTriggers>
      </li>
    </stages>
  </RitualBehaviorDef>

  
  <RitualBehaviorDef Name="Revia_SacrificeBehaviorBase" Abstract="True" ParentName="Revia_DateRitualBehavior">
    <preceptRequirements><li Class="PreceptRequirement_Altar"/></preceptRequirements>
    <durationTicks>7500</durationTicks>
    <roles Inherit="False">
      <li Class="ReviaRace.RitualRoleReviaOrSkarnite">
        <label>cutter</label>
        <id>cutter</id>
        <precept>Revia_PrisonerSacrification</precept>
        <required>True</required>
        <substitutable>true</substitutable>
        <maxCount>1</maxCount>
        <countsAsParticipant>False</countsAsParticipant>
        <mustBeAbleToReachTarget>True</mustBeAbleToReachTarget>
      </li>
    </roles>
  </RitualBehaviorDef>

  <RitualBehaviorDef ParentName="Revia_SacrificeBehaviorBase">
    <defName>Revia_SacrificePrisoner</defName>
    <workerClass>RitualBehaviorWorker_PrisonerSacrifice</workerClass>
    <roles>
      <li Class="RitualRolePrisoner">
        <label>sacrifice</label>
        <missingDesc>a prisoner</missingDesc>
        <id>prisoner</id>
        <maxCount>1</maxCount>
        <required>True</required>
        <countsAsParticipant>False</countsAsParticipant>
        <ignoreBleeding>true</ignoreBleeding>
        <allowDowned>true</allowDowned>
      </li>
    </roles>
    <stages Inherit="False">
      <li Class="RitualStage_InteractWithPrisoner">
        <defaultDuty>Spectate</defaultDuty>
        <endTriggers>
          <li Class="StageEndTrigger_PawnDeliveredOrNotValid"/>
        </endTriggers>
        <failTriggers>
          <li Class="StageFailTrigger_TargetPawnUnreachable">
            <takerId>cutter</takerId>
            <takeeId>prisoner</takeeId>
            <desc>Prisoner is not reachable.</desc>
          </li>
          <li Class="StageFailTrigger_PawnAsleep">
            <desc>escort asleep</desc>
            <pawnId>cutter</pawnId>
          </li>
        </failTriggers>
        <roleBehaviors>
          <li>
            <roleId>cutter</roleId>
            <dutyDef>Revia_DeliverPawnToAltar</dutyDef>
          </li>
          <li>
            <roleId>prisoner</roleId>
            <dutyDef>Idle</dutyDef>
          </li>
        </roleBehaviors>
      </li>
      <li>
        <defaultDuty>Spectate</defaultDuty>
        <endTriggers>
          <li Class="StageEndTrigger_DurationPercentage">
            <percentage>0.999</percentage>
          </li>
        </endTriggers>
        <roleBehaviors>
          <li>
            <roleId>cutter</roleId>
            <dutyDef>Revia_SpeakOnCellFacingSpectators</dutyDef>
            <speakerInteraction>Revia_Speech_Sacrifice</speakerInteraction>
            <customPositions>
              <!--<li Class="RitualPosition_Lectern">
                <maxDistanceToFocus>5</maxDistanceToFocus>
              </li>-->
              <li Class="RitualPosition_OnInteractionCell" />
            </customPositions>
          </li>
          <li>
            <roleId>prisoner</roleId>
            <dutyDef>LayDownAwake</dutyDef>
          </li>
        </roleBehaviors>
      </li>
      <li Class="RitualStage_InteractWithPrisoner">
        <defaultDuty>Spectate</defaultDuty>
        <essential>True</essential>
        <endTriggers>
          <li Class="StageEndTrigger_PawnDead">
            <roleId>prisoner</roleId>
          </li>
        </endTriggers>
        <roleBehaviors>
          <li>
            <roleId>cutter</roleId>
            <dutyDef>Revia_Sacrifice</dutyDef>
            <customPositions>
              <li Class="RitualPosition_OnInteractionCell" />
            </customPositions>
          </li>
          <li>
            <roleId>prisoner</roleId>
            <dutyDef>LayDownAwake</dutyDef>
          </li>
        </roleBehaviors>
        <visualEffectDef>Revia_SacrificePrisoner</visualEffectDef>
      </li>
      <li>
        <defaultDuty>Spectate</defaultDuty>
        <endTriggers>
          <li Class="StageEndTrigger_DurationPercentage">
            <percentage>0.001</percentage>
          </li>
        </endTriggers>
        <failTriggers>
          <li Class="StageFailTrigger_PawnAlive">
            <pawnId>prisoner</pawnId>
            <desc>sacrifice no longer dead</desc>
          </li>
        </failTriggers>
        <roleBehaviors>
          <li>
            <roleId>cutter</roleId>
            <dutyDef>Revia_SpeakOnCellFacingSpectators</dutyDef>
            <speakerInteraction>Revia_Speech_Sacrifice</speakerInteraction>
            <customPositions>
              <li Class="RitualPosition_OnInteractionCell" />
            </customPositions>
          </li>
        </roleBehaviors>
      </li>
    </stages>
  </RitualBehaviorDef>



	<RitualBehaviorDef ParentName="DateRitualBehavior">
		<defName>ReviaBlessingRitual</defName>
		<durationTicks>7500</durationTicks>
		<roles Inherit="False">
			<li Class="ReviaRace.RitualRoleReviaOrSkarnite">
				<label>sacrificer</label>
				<id>sacrificer</id>
				<precept>Revia_BlessingForSoulreap</precept>
				<required>True</required>
				<substitutable>true</substitutable>
				<maxCount>1</maxCount>
				<countsAsParticipant>False</countsAsParticipant>
				<mustBeAbleToReachTarget>True</mustBeAbleToReachTarget>
			</li>
		</roles>
		<spectatorsLabel>Participants</spectatorsLabel>
		<spectatorGerund>participate</spectatorGerund>
		<stages Inherit="False">
			<li>
				<defaultDuty>Spectate</defaultDuty>
				<essential>True</essential>
				<endTriggers>
					<li Class="StageEndTrigger_DurationPercentage">
						<percentage>0.6</percentage>
					</li>
				</endTriggers>
				<!--
				
				<pawnLeaveAction Class="RitualStageAction_DropThing">
					<def>WoodLog</def>
					<count>4</count>
				</pawnLeaveAction>
				<interruptedAction Class="RitualStageAction_DropThing">
					<def>WoodLog</def>
					<count>4</count>
				</interruptedAction>
				<tickActionMaker Class="RitualStageAction_ReleaseLanterns">
					<woodCost>4</woodCost>
					<preliminaryTicks>0~90</preliminaryTicks>
				</tickActionMaker>
				
				-->
				<roleBehaviors>
					<li>
						<roleId>sacrificer</roleId>
						<dutyDef>InvokeBlessingForSoulreap</dutyDef>
						<speakerInteraction>Revia_Speech_Sacrifice</speakerInteraction>
						<customPositions>
							<!--<li Class="RitualPosition_Lectern">
                <maxDistanceToFocus>5</maxDistanceToFocus>
              </li>-->
							<li Class="RitualPosition_OnInteractionCell" />
						</customPositions>
					</li>
				</roleBehaviors>
			</li>
			<li>
				<defaultDuty>Spectate</defaultDuty>
				<endTriggers>
					<li Class="StageEndTrigger_DurationPercentage">
						<percentage>0.4</percentage>
					</li>
				</endTriggers>
			</li>
		</stages>
	</RitualBehaviorDef>

</Defs>